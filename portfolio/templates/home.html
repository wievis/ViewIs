{% extends 'base.html' %}
{% load static %}
{% block title %}Portfolio | Computer Designer{% endblock %}

{% block extra_head %}
<style>
    .gallery { padding: 1rem; max-width: 1400px; margin: 0 auto; }
    .stack-group { 
        position: relative; 
        width: 100%; 
        height: auto; 
        min-height: 650px; 
        margin-bottom: 12rem;
    }
    .stack-item { 
        position: absolute; 
        transition: all 0.4s ease; 
        cursor: pointer;
        width: 80%;
        max-width: 900px;
    }
    .stack-item img { width: 100%; height: auto; display: block; box-shadow: 0 10px 30px rgba(0,0,0,0.5); border-radius: 4px; }
    
    /* Rozpiętość w poziomie */
    .stack-item:nth-child(1) { transform: translateX(0) rotate(-1deg); z-index: 10; }
    .stack-item:nth-child(2) { transform: translateX(40px) translateY(10px) rotate(1deg); z-index: 9; }
    .stack-item:nth-child(3) { transform: translateX(80px) translateY(20px) rotate(-0.5deg); z-index: 8; }
    .stack-item:nth-child(4) { transform: translateX(120px) translateY(30px) rotate(0.5deg); z-index: 7; }
    .stack-item:nth-child(5) { transform: translateX(160px) translateY(40px) rotate(0deg); z-index: 6; }

    .stack-item:hover { 
        z-index: 100 !important; 
        transform: scale(1.03) translateY(-15px) translateX(20px) !important; 
    }

    .media-item { margin-bottom: 10rem; cursor: pointer; }
    .media-content img, .media-content video { width: 100%; height: auto; display: block; }
    .model-viewer { width: 100%; height: 600px; display: block; }

    @media (max-width: 768px) { 
        .stack-group { min-height: 450px; margin-bottom: 5rem; }
        .stack-item { width: 90%; }
    }
</style>
{% endblock %}

{% block content %}
<div class="gallery">
    {% for album in albums %}
    <div class="stack-group">
        {% for item in album.media_items.all %}
        <div class="stack-item" onclick="openLightboxByUrl('{{ item.file.url }}')">
            <img src="{{ item.file.url }}">
        </div>
        {% endfor %}
    </div>
    {% endfor %}

    {% for item in standalone_media %}
    <div class="media-item" onclick="openLightboxByUrl('{{ item.file.url }}')">
        <div class="media-content">
            {% if item.media_type == 'image' %}
                <img src="{{ item.file.url }}">
            {% elif item.media_type == 'video' %}
                <video src="{{ item.file.url }}" autoplay loop muted playsinline></video>
            {% elif item.media_type == 'model3d' %}
                <div class="model-viewer" data-model="{{ item.file.url }}" data-hdr="{% if item.hdr_setting %}{{ item.hdr_setting.file.url }}{% endif %}"></div>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>

<script>
    window.mediaItems = [
        {% for item in media_items %}
        { url: "{{ item.file.url }}", type: "{{ item.media_type }}", hdr: "{% if item.hdr_setting %}{{ item.hdr_setting.file.url }}{% endif %}" }
        {% if not forloop.last %},{% endif %}{% endfor %}
    ];
    function openLightboxByUrl(url) {
        const idx = window.mediaItems.findIndex(i => i.url === url);
        if (idx !== -1) openLightbox(idx);
    }
</script>
{% endblock %}